<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8">
  <title>DPD pakiautomaadid kaardil</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #kaart { height: 600px; margin-top: 20px; }
    input { padding: 6px; width: 300px; }
  </style>
</head>
<body>
  <h2>Otsi DPD pakiautomaate</h2>
  <input type="text" id="otsing" placeholder="Sisesta linn v천i aadress..." oninput="filtreeri()">
  <div id="kaart"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const kaart = L.map('kaart').setView([58.5953, 25.0136], 6); // Eesti keskpunkt
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap'
    }).addTo(kaart);

    let k천ikAndmed = [];
    let markerid = [];

    fetch('https://dpdbaltics.com/PickupParcelShopData.json')
      .then(res => res.json())
      .then(data => {
        k천ikAndmed = data;
        kuvaMarkerid(data);
      });

    function filtreeri() {
      const sisend = document.getElementById("otsing").value.toLowerCase();
      const filtreeritud = k천ikAndmed.filter(p =>
        (p.Name + p.Address + p.City + p.Country).toLowerCase().includes(sisend)
      );
      kuvaMarkerid(filtreeritud);
    }

    function kuvaMarkerid(andmed) {
      markerid.forEach(m => kaart.removeLayer(m));
      markerid = [];

      andmed.forEach(p => {
        if (p.Latitude && p.Longitude) {
          const m = L.marker([p.Latitude, p.Longitude])
            .addTo(kaart)
            .bindPopup(`<strong>${p.Name}</strong><br>${p.Address}, ${p.City}`);
          markerid.push(m);
        }
      });
    }
  </script>
</body>
</html>
